---
sidebar_position: 2
---

# Service

This page describes the configuration required to communicate with a custom API service.

<h2>How To</h2>

Define the target api endpoint and other required configuration inside the [`request`](#request) property.

By default, the **outgoing** request bodies will contain all of the messages within the chat (to allow the target service to interpret their context as needed).
This behaviour can be altered by using the [`requestBodyMessageLimits`](#requestBodyMessageLimits) property to send only what is required.

- When sending text based messages only, the request body will have the following JSON type: <br />
  {[`messages: MessageContent[]`](./messages/#MessageContent)} <br />

- When sending messages that contains files, the request body is going to be encapsulated inside a [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData) type.

The **response** message body needs to have the following JSON type: <br />
&nbsp;&nbsp;&nbsp;&nbsp {[`result?: Result`](#Result), `error?: string`} <br />

Please see [`examples`](https://github.com/OvidijusParsiunas/deep-chat/tree/main/other-packages/servers) on how to set up your own server.

<h2>Component properties</h2>

import ComponentContainer from '@site/src/components/table/componentContainer';
import DeepChatBrowser from '@site/src/components/table/deepChatBrowser';
import LineBreak from '@site/src/components/markdown/lineBreak';
import BrowserOnly from '@docusaurus/BrowserOnly';
import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

<BrowserOnly>{() => require('@site/src/components/nav/autoNavToggle').readdAutoNavShadowToggle()}</BrowserOnly>

### `request` {#request}

- Type: [`Request`](#Request)

Configuration for the outgoing message HTTP requests.

<ComponentContainer>
  <DeepChatBrowser
    containerStyle={{borderRadius: '8px'}}
    request={{
      url: 'https://customapi.com/message',
      method: 'POST',
      headers: {customName: 'customHeaderValue'},
      body: {field: 'value'},
    }}
  ></DeepChatBrowser>
</ComponentContainer>

<Tabs>
<TabItem value="js" label="Sample code">

```html
<deep-chat
  request='{
    "url": "https://customapi.com/message",
    "method": "POST",
    "headers": {"customName": "customHeaderValue"},
    "body": {"field": "value"}
  }'
></deep-chat>
```

</TabItem>
<TabItem value="py" label="Full code">

```html
<!-- This example is for Vanilla JS and should be tailored to your framework (see Examples) -->

<deep-chat
  request='{
    "url": "https://customapi.com/message",
    "method": "POST",
    "headers": {"customName": "customHeaderValue"},
    "body": {"field": "value"}
  }'
  containerStyle='{"borderRadius": "8px"}'
></deep-chat>
```

</TabItem>
</Tabs>

<LineBreak></LineBreak>

### `stream` {#stream}

- Type: `boolean`

If the target service supports [`server-sent events`](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events) via the `text/event-stream` MIME type, you
can stream the response messages into the chat. This is only supported for text messages. Please see [`examples`](https://github.com/OvidijusParsiunas/deep-chat/tree/main/other-packages/servers) on how to set this up for your own server.

<ComponentContainer>
  <DeepChatBrowser
    containerStyle={{borderRadius: '8px'}}
    stream={true}
    existingService={{demo: true}}
    introMessage={`The response message bubble will be populated gradually with text events.`}
  ></DeepChatBrowser>
</ComponentContainer>

<Tabs>
<TabItem value="js" label="Sample code">

```html
<deep-chat stream="true"></deep-chat>
```

</TabItem>
<TabItem value="py" label="Full code">

```html
<!-- This example is for Vanilla JS and should be tailored to your framework (see Examples) -->

<deep-chat
  stream="true"
  existingService='{"demo": true}'
  containerStyle='{"borderRadius": "8px"}'
  introMessage="The response message bubble will be populated gradually with text events."
></deep-chat>
```

</TabItem>
</Tabs>

<LineBreak></LineBreak>

### `requestBodyMessageLimits` {#requestBodyMessageLimits}

- Type: {`maxMessages?: number`, `totalMessagesMaxCharLength?: number`}

Used to limit the message content that is going to be included in the outgoing requests. <br />
`maxMessages` is the maximum number of messages counting from the most recent one. <br />
`totalMessagesMaxCharLength` is the total maximum number of text characters that can be included counting from the most recent message. <br />
These limits do not include the [`introMessage`](./messages#introMessage).

<ComponentContainer>
  <DeepChatBrowser
    containerStyle={{borderRadius: '8px'}}
    introMessage={`Observe the data that is going to be sent below.`}
    requestBodyMessageLimits={{
      totalMessagesMaxCharLength: 20,
      maxMessages: 2,
    }}
    existingService={{demo: true}}
  ></DeepChatBrowser>
</ComponentContainer>

<Tabs>
<TabItem value="js" label="Sample code">

```html
<deep-chat
  requestBodyMessageLimits='{
    "totalMessagesMaxCharLength": 20,
    "maxMessages": 2
  }'
></deep-chat>
```

</TabItem>
<TabItem value="py" label="Full code">

```html
<!-- This example is for Vanilla JS and should be tailored to your framework (see Examples) -->

<deep-chat
  requestBodyMessageLimits='{
    "totalMessagesMaxCharLength": 20,
    "maxMessages": 2
  }'
  containerStyle='{"borderRadius": "8px"}'
  existingService='{"demo": true}'
  introMessage="Observe the data that is going to be sent below."
></deep-chat>
```

</TabItem>
</Tabs>

<LineBreak></LineBreak>

## Types

Types shared with other component properties:

### `Request` {#Request}

- Type: {<br />
  &nbsp;&nbsp;&nbsp;&nbsp; `url: string`, <br />
  &nbsp;&nbsp;&nbsp;&nbsp; `method?: string`, <br />
  &nbsp;&nbsp;&nbsp;&nbsp; `headers?: {[string]: string}`, <br />
  &nbsp;&nbsp;&nbsp;&nbsp; `body?: {[string]: any}` <br />
  }

- Default: _{ method: "POST" }_

Object used to configure the outgoing messages' HTTP request settings. <br />
`body` is used to add additional key value properties to the outgoing message body.

<ComponentContainer>
  <DeepChatBrowser
    containerStyle={{borderRadius: '8px'}}
    request={{
      url: 'https://customapi.com/message',
      method: 'POST',
      headers: {customName: 'customHeaderValue'},
      body: {customBodyField: 'customBodyValue'},
    }}
  ></DeepChatBrowser>
</ComponentContainer>

<Tabs>
<TabItem value="js" label="Sample code">

```html
<deep-chat
  request='{
    "url": "https://customapi.com/message",
    "method": "POST",
    "headers": {"customName": "customHeaderValue"},
    "body": {"customBodyField": "customBodyValue"}
  }'
></deep-chat>
```

</TabItem>
<TabItem value="py" label="Full code">

```html
<!-- This example is for Vanilla JS and should be tailored to your framework (see Examples) -->

<deep-chat
  request='{
    "url": "https://customapi.com/message",
    "method": "POST",
    "headers": {"customName": "customHeaderValue"},
    "body": {"customBodyField": "customBodyValue"}
  }'
  containerStyle='{"borderRadius": "8px"}'
></deep-chat>
```

</TabItem>
</Tabs>

<LineBreak></LineBreak>

### `Result` {#Result}

- Type: {`text?: string`, [`files?: MessageFile[]`](./messages#MessageFile)}

Object containing result information retrieved from the target service. <br />
`text` is the message text content. <br />
`files` is an array of details about response files.

<LineBreak></LineBreak>
