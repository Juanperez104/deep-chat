---
sidebar_position: 2
---

# Connect

<h2>How to connect to an API</h2>

This is achieved by simply defining the request details inside the [`request`](#request) property.

<h3>Request message</h3>

Outgoing request body contains all of the messages from the chat (to allow the target service to interpret its context as needed) and is encapsulated in one of the following formats:

- When sending **text** based messages only, the request body will have the following JSON type: <br />
  {[`messages: MessageContent[]`](./messages/#MessageContent)} <br />

// WORK - all messages should use the format above

- When sending messages that contains **files**, the request body is going to be serialized inside a [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData) type.

:::tip
To limit the number of messages included in the request - use the [`requestBodyMessageLimits`](#requestBodyMessageLimits) property.
:::

<h3>Response message</h3>

The response message body needs to use the following JSON type: <br />
&nbsp;&nbsp;&nbsp;&nbsp {[`result?: Result`](#Result), `error?: string`} <br />

Please see full code EXAMPLES on how to set up your own server [`HERE`](https://github.com/OvidijusParsiunas/deep-chat/tree/main/other-packages/servers).

:::tip
If you don't want / can't change the target service to adhere to the required formats listed above, you can use the [`requestInterceptor`](interceptors/#requestInterceptor)
and [`responseInterceptor`](interceptors/#responseInterceptor) properties to augment the incoming and outgoing message bodies into the format you need.
:::

<h2>Component properties</h2>

import ComponentContainer from '@site/src/components/table/componentContainer';
import DeepChatBrowser from '@site/src/components/table/deepChatBrowser';
import LineBreak from '@site/src/components/markdown/lineBreak';
import BrowserOnly from '@docusaurus/BrowserOnly';
import TabItem from '@theme/TabItem';
import Tabs from '@theme/Tabs';

<BrowserOnly>{() => require('@site/src/components/nav/autoNavToggle').readdAutoNavShadowToggle()}</BrowserOnly>

### `request` {#request}

- Type: [`Request`](#Request)

Configuration for the outgoing message HTTP requests.

<ComponentContainer>
  <DeepChatBrowser
    containerStyle={{borderRadius: '8px'}}
    request={{
      url: 'https://customapi.com/message',
      method: 'POST',
      headers: {customName: 'customHeaderValue'},
      body: {field: 'value'},
    }}
  ></DeepChatBrowser>
</ComponentContainer>

<Tabs>
<TabItem value="js" label="Sample code">

```html
<deep-chat
  request='{
    "url": "https://customapi.com/message",
    "method": "POST",
    "headers": {"customName": "customHeaderValue"},
    "body": {"field": "value"}
  }'
></deep-chat>
```

</TabItem>
<TabItem value="py" label="Full code">

```html
<!-- This example is for Vanilla JS and should be tailored to your framework (see Examples) -->

<deep-chat
  request='{
    "url": "https://customapi.com/message",
    "method": "POST",
    "headers": {"customName": "customHeaderValue"},
    "body": {"field": "value"}
  }'
  containerStyle='{"borderRadius": "8px"}'
></deep-chat>
```

</TabItem>
</Tabs>

<LineBreak></LineBreak>

### `stream` {#stream}

- Type: `boolean`

If the target service supports [`server-sent events`](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events) via the `text/event-stream` MIME type, you
can stream the response messages into the chat. This is only supported for text messages.
Please see [`examples`](https://github.com/OvidijusParsiunas/deep-chat/tree/main/other-packages/servers) on how to set this up for your own server.

<ComponentContainer>
  <DeepChatBrowser
    containerStyle={{borderRadius: '8px'}}
    stream={true}
    directConnection={{demo: true}}
    introMessage={`The response message bubble will be populated gradually with text events.`}
  ></DeepChatBrowser>
</ComponentContainer>

<Tabs>
<TabItem value="js" label="Sample code">

```html
<deep-chat stream="true"></deep-chat>
```

</TabItem>
<TabItem value="py" label="Full code">

```html
<!-- This example is for Vanilla JS and should be tailored to your framework (see Examples) -->

<deep-chat
  stream="true"
  directConnection='{"demo": true}'
  containerStyle='{"borderRadius": "8px"}'
  introMessage="The response message bubble will be populated gradually with text events."
></deep-chat>
```

</TabItem>
</Tabs>

<LineBreak></LineBreak>

### `requestBodyMessageLimits` {#requestBodyMessageLimits}

- Type: {`maxMessages?: number`, `totalMessagesMaxCharLength?: number`}

Used to limit the message content that is going to be included in the outgoing requests. <br />
`maxMessages` is the maximum number of messages counting from the most recent one. <br />
`totalMessagesMaxCharLength` is the total maximum number of text characters that can be included counting from the most recent message. <br />
These limits do not include the [`introMessage`](./messages#introMessage).

<ComponentContainer>
  <DeepChatBrowser
    containerStyle={{borderRadius: '8px'}}
    introMessage={`Observe the data that is going to be sent below.`}
    requestBodyMessageLimits={{
      totalMessagesMaxCharLength: 20,
      maxMessages: 2,
    }}
    directConnection={{demo: true}}
  ></DeepChatBrowser>
</ComponentContainer>

<Tabs>
<TabItem value="js" label="Sample code">

```html
<deep-chat
  requestBodyMessageLimits='{
    "totalMessagesMaxCharLength": 20,
    "maxMessages": 2
  }'
></deep-chat>
```

</TabItem>
<TabItem value="py" label="Full code">

```html
<!-- This example is for Vanilla JS and should be tailored to your framework (see Examples) -->

<deep-chat
  requestBodyMessageLimits='{
    "totalMessagesMaxCharLength": 20,
    "maxMessages": 2
  }'
  containerStyle='{"borderRadius": "8px"}'
  directConnection='{"demo": true}'
  introMessage="Observe the data that is going to be sent below."
></deep-chat>
```

</TabItem>
</Tabs>

<LineBreak></LineBreak>

## Types

Types shared with other component properties:

### `Request` {#Request}

- Type: {<br />
  &nbsp;&nbsp;&nbsp;&nbsp; `url: string`, <br />
  &nbsp;&nbsp;&nbsp;&nbsp; `method?: string`, <br />
  &nbsp;&nbsp;&nbsp;&nbsp; `headers?: {[string]: string}`, <br />
  &nbsp;&nbsp;&nbsp;&nbsp; `body?: {[string]: any}` <br />
  }

- Default: _{ method: "POST" }_

Object used to configure the outgoing messages' HTTP request settings. <br />
`body` is used to add additional key value properties to the outgoing message body.

<ComponentContainer>
  <DeepChatBrowser
    containerStyle={{borderRadius: '8px'}}
    request={{
      url: 'https://customapi.com/message',
      method: 'POST',
      headers: {customName: 'customHeaderValue'},
      body: {customBodyField: 'customBodyValue'},
    }}
  ></DeepChatBrowser>
</ComponentContainer>

<Tabs>
<TabItem value="js" label="Sample code">

```html
<deep-chat
  request='{
    "url": "https://customapi.com/message",
    "method": "POST",
    "headers": {"customName": "customHeaderValue"},
    "body": {"customBodyField": "customBodyValue"}
  }'
></deep-chat>
```

</TabItem>
<TabItem value="py" label="Full code">

```html
<!-- This example is for Vanilla JS and should be tailored to your framework (see Examples) -->

<deep-chat
  request='{
    "url": "https://customapi.com/message",
    "method": "POST",
    "headers": {"customName": "customHeaderValue"},
    "body": {"customBodyField": "customBodyValue"}
  }'
  containerStyle='{"borderRadius": "8px"}'
></deep-chat>
```

</TabItem>
</Tabs>

<LineBreak></LineBreak>

### `Result` {#Result}

- Type: {`text?: string`, [`files?: MessageFile[]`](./messages#MessageFile)}

Object containing result information retrieved from the target service. <br />
`text` is the message text content. <br />
`files` is an array of details about response files.

<LineBreak></LineBreak>
